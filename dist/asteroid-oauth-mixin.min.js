!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AsteroidOauthMixin=t():e.AsteroidOauthMixin=t()}(this,function(){return function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t["default"]=e,t}function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.endpoint,o=e.platform;this.subscribe("meteor.loginServiceConfiguration"),this.oauth={platform:o,url:(0,u["default"])(t)}}function s(e){v[e.name]=e}function l(e,t){var o=this,n=v[e].getOptions({url:this.oauth.url,configCollection:this.getServiceConfig(e),scope:t});return console.log(n),(0,f["default"])(this.oauth.platform,this.oauth.url.host,n.credentialToken,n.loginUrl,function(e){return o.login({oauth:e})})}Object.defineProperty(t,"__esModule",{value:!0}),t.init=i,t.registerOauthProvider=s,t.loginWith=l;var c=o(1),u=r(c),a=o(5),f=r(a),p=o(8),d=n(p),h=o(13),g=n(h),v={google:d,facebook:g}},function(e,t,o){"use strict";function n(e,t,o){if(!(this instanceof n))return new n(e,t,o);var u,a,f,p,d=l.test(e),h=typeof t,g=this,v=0;for("object"!==h&&"string"!==h&&(o=t,t=null),o&&"function"!=typeof o&&(o=s.parse),t=i(t);v<c.length;v++)a=c[v],u=a[0],p=a[1],u!==u?g[p]=e:"string"==typeof u?~(f=e.indexOf(u))&&("number"==typeof a[2]?(g[p]=e.slice(0,f),e=e.slice(f+a[2])):(g[p]=e.slice(f),e=e.slice(0,f))):(f=u.exec(e))&&(g[p]=f[1],e=e.slice(0,e.length-f[0].length)),g[p]=g[p]||(a[3]||"port"===p&&d?t[p]||"":""),a[4]&&(g[p]=g[p].toLowerCase());o&&(g.query=o(g.query)),r(g.port,g.protocol)||(g.host=g.hostname,g.port=""),g.username=g.password="",g.auth&&(a=g.auth.split(":"),g.username=a[0]||"",g.password=a[1]||""),g.href=g.toString()}var r=o(2),i=o(3),s=o(4),l=/^\/(?!\/)/,c=[["#","hash"],["?","query"],["//","protocol",2,1,1],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/\:(\d+)$/,"port"],[NaN,"hostname",void 0,1,1]];n.prototype.set=function(e,t,o){var n=this;return"query"===e?("string"==typeof t&&t.length&&(t=(o||s.parse)(t)),n[e]=t):"port"===e?(n[e]=t,r(t,n.protocol)?t&&(n.host=n.hostname+":"+t):(n.host=n.hostname,n[e]="")):"hostname"===e?(n[e]=t,n.port&&(t+=":"+n.port),n.host=t):"host"===e?(n[e]=t,/\:\d+/.test(t)&&(t=t.split(":"),n.hostname=t[0],n.port=t[1])):n[e]=t,n.href=n.toString(),n},n.prototype.toString=function(e){e&&"function"==typeof e||(e=s.stringify);var t,o=this,n=o.protocol+"//";return o.username&&(n+=o.username,o.password&&(n+=":"+o.password),n+="@"),n+=o.hostname,o.port&&(n+=":"+o.port),n+=o.pathname,t="object"==typeof o.query?e(o.query):o.query,t&&(n+="?"!==t.charAt(0)?"?"+t:t),o.hash&&(n+=o.hash),n},n.qs=s,n.location=i,e.exports=n},function(e,t){"use strict";e.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},function(e,t,o){(function(t){"use strict";var n,r={hash:1,query:1};e.exports=function(e){e=e||t.location||{},n=n||o(1);var i,s={},l=typeof e;if("blob:"===e.protocol)s=new n(unescape(e.pathname),{});else if("string"===l){s=new n(e,{});for(i in r)delete s[i]}else if("object"===l)for(i in e)i in r||(s[i]=e[i]);return s}}).call(t,function(){return this}())},function(e,t){"use strict";function o(e){for(var t,o=/([^=?&]+)=([^&]*)/g,n={};t=o.exec(e);n[decodeURIComponent(t[1])]=decodeURIComponent(t[2]));return n}function n(e,t){t=t||"";var o=[];"string"!=typeof t&&(t="?");for(var n in e)r.call(e,n)&&o.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return o.length?t+o.join("&"):""}var r=Object.prototype.hasOwnProperty;t.stringify=n,t.parse=o},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,o,n,r){var i=u[e],s=new i({host:t,credentialToken:o,loginUrl:n});return s.init().then(r)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=r;var i=o(6),s=n(i),l=o(7),c=n(l),u={browser:s["default"],chrome:c["default"]};e.exports=t["default"]},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),s=o(1),l=n(s),c=function(){function e(t){var o=this,n=t.credentialToken,i=t.host,s=t.loginUrl;r(this,e),this.credentialToken=n,this.host=i,this.loginUrl=s,this._credentialSecretPromise=new Promise(function(e,t){o._resolvePromise=e,o._rejectPromise=t})}return i(e,[{key:"_startPolling",value:function(){var e=this;console.group("Start Polling"),console.log("%cHost","color: #4AF2A1",this.host),console.log("%cCredentail Token","color: #6638F0",this.credentialToken);var t=JSON.stringify({credentialToken:this.credentialToken});console.log(this.popup.document.querySelector("#config")),this.intervalId=window.setInterval(function(){e.popup.postMessage(t,e.host)},100),window.addEventListener("message",this._onMessage.bind(this)),console.groupEnd()}},{key:"_stopPolling",value:function(){window.clearInterval(this.intervalId)}},{key:"_onMessage",value:function(e){var t=e.data,o=e.origin;try{var n=JSON.parse(t);if((0,l["default"])(o).host!==this.host)return;n.credentialToken===this.credentialToken&&this._resolvePromise({credentialToken:n.credentialToken,credentialSecret:n.credentialSecret}),n.error&&this._rejectPromise(n.error)}catch(r){}}},{key:"_openPopup",value:function(){console.group("Open Popup"),console.log("%cLogin URL","color: #4AF2A1",this.loginUrl),this.popup=window.open(this.loginUrl,"_blank","location=no,toolbar=no"),console.log("%cPopup window","color: #6638F0",this.popup),this.popup.focus&&this.popup.focus(),console.groupEnd()}},{key:"_closePopup",value:function(){this.popup.close()}},{key:"init",value:function(){var e=this;return this._openPopup(),this._startPolling(),this._credentialSecretPromise.then(function(t){return console.log("Before close Popup"),e._stopPolling(),e._closePopup(),console.log(t),t})}}]),e}();t["default"]=c,e.exports=t["default"]},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),s=o(1),l=(n(s),function(){function e(t){var o=this,n=t.credentialToken,i=t.host,s=t.loginUrl;r(this,e),this.credentialToken=n,this.host=i,this.loginUrl=s,this._credentialSecretPromise=new Promise(function(e,t){o._resolvePromise=e,o._rejectPromise=t}),this._onTabUpdated=this._onTabUpdated.bind(this)}return i(e,[{key:"_startPolling",value:function(){console.group("Start Polling"),console.log("%cHost","color: #4AF2A1",this.host),console.log("%cCredentail Token","color: #6638F0",this.credentialToken);JSON.stringify({credentialToken:this.credentialToken});chrome.tabs.onUpdated.addListener(this._onTabUpdated),console.groupEnd()}},{key:"_onTabUpdated",value:function(e,t){var o=t.url;if(console.log("%cTab's Id:","color: #4AF2A1",e),console.log("%cTab's URL:","color: #6638F0",o),e===this.tabId&&o&&-1!==o.indexOf("#")){var n=o.indexOf("#"),r=void 0;try{var i=o.slice(n+1),s=decodeURIComponent(i);console.log("%cEncoded hash string:","color: #5E5C95",i),console.log("%cDecoded hash string:","color: #BB4A51",s),r=JSON.parse(s),console.log("%cHash:","color: #F6CD77",r)}catch(l){return void console.error(l)}console.log("Hash Token:",r.credentialToken),console.log("Hash Token:",this.credentialToken),r.credentialToken===this.credentialToken&&(this._resolvePromise({credentialToken:r.credentialToken,credentialSecret:r.credentialSecret}),chrome.tabs.remove(id))}}},{key:"_openPopup",value:function(){var e=this;console.group("Open Popup"),console.log("%cLogin URL","color: #4AF2A1",this.loginUrl),chrome.tabs.create({url:this.loginUrl},function(t){e.tabId=t.id}),console.log("%cPopup tab's Id","color: #6638F0",this.tabId),console.groupEnd()}},{key:"init",value:function(){return this._openPopup(),this._startPolling(),this._credentialSecretPromise.then(function(e){return console.log("Before close Popup"),console.log(e),e})}}]),e}());t["default"]=l,e.exports=t["default"]},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e){var t=e.url,o=e.configCollection,n=e.scope,r=(0,c["default"])(),i=t.protocol,l=t.host,u={response_type:"code",client_id:(0,p["default"])(o),redirect_uri:(0,h["default"])(i)+("//"+l+"/_oauth/google"),state:(0,a["default"])(r),scope:n||"openid email"},f=(0,s["default"])("https://accounts.google.com/o/oauth2/auth").set("query",u).toString();return{credentialToken:r,loginUrl:f}}Object.defineProperty(t,"__esModule",{value:!0}),t.getOptions=r;var i=o(1),s=n(i),l=o(9),c=n(l),u=o(10),a=n(u),f=o(11),p=n(f),d=o(12),h=n(d),g="google";t.name=g},function(e,t){"use strict";function o(){for(var e="",t=0;8>t;t++)e+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return e}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=o,e.exports=t["default"]},function(e,t){"use strict";function o(e){var t={loginStyle:"popup",credentialToken:e,isCordova:!1};return window.btoa(JSON.stringify(t))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=o,e.exports=t["default"]},function(e,t){"use strict";function o(e){return e.clientId||e.consumerKey||e.appId}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=o,e.exports=t["default"]},function(e,t){"use strict";function o(e){return"ws:"===e||"http:"===e?"http:":"wss:"===e||"https:"===e?"https:":void 0}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=o,e.exports=t["default"]},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e){var t=e.url,o=e.configCollection,n=e.scope,r=(0,c["default"])(),i=t.protocol,l=t.host,u={client_id:(0,p["default"])(o),redirect_uri:(0,h["default"])(i)+("//"+l+"/_oauth/facebook"),state:(0,a["default"])(r),scope:n||"email"},f=(0,s["default"])("https://www.facebook.com/dialog/oauth?").set("query",u).toString();return{credentialToken:r,loginUrl:f}}Object.defineProperty(t,"__esModule",{value:!0}),t.getOptions=r;var i=o(1),s=n(i),l=o(9),c=n(l),u=o(10),a=n(u),f=o(11),p=n(f),d=o(12),h=n(d),g="facebook";t.name=g}])});